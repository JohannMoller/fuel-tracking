id: new-entry
type: Box
properties:
  title: New Entry
layout:
  size: 800

requests:
  - id: insert_entry
    type: MongoDBInsertOne
    connectionId: fuel-log
    payload:
      new:
        _state: new
    properties:
      doc:
        _payload: new

events:
  onInit:
    - id: init_state
      type: SetState
      params:
        new.date:
          _date: now
        new.fuel_type: 'ULP 93'

blocks:
  - id: card
    type: Card
    layout:
      contentGutter: 8
    blocks:
      - id: title
        type: Title
        properties:
          content: Log an Entry
          level: 2
      - id: new.date
        type: DateSelector
        layout:
          sm:
            span: 12
        properties:
          title: Date
          allowClear: false
      - id: new.fuel_type
        type: ButtonSelector
        layout:
          sm:
            span: 12
        properties:
          title: Fuel type
          options:
            - ULP 93
            - ULP 95
      - id: new.trip
        type: NumberInput
        layout:
          sm:
            span: 12
        required: true
        properties:
          title: Trip [km]
          placeholder: km
          min: 0
      - id: new.full_mileage
        type: NumberInput
        layout:
          sm:
            span: 12
        properties:
          title: Total mileage [km]
          placeholder: km
          min: 0
      - id: new.litres_per_100km
        type: NumberInput
        layout:
          sm:
            span: 12
        properties:
          title: Usage
          placeholder: L/100km
          min: 0
      - id: new.price_per_litre
        type: NumberInput
        layout:
          sm:
            span: 12
        required: true
        properties:
          title: Price [R/L]
          placeholder: R/L
          min: 0
      - id: new.full_price
        type: NumberInput
        layout:
          sm:
            span: 12
        required: true
        properties:
          title: Total price [R]
          placeholder: R
          min: 0
      - id: new.litres
        type: NumberInput
        layout:
          sm:
            span: 12
        required: true
        properties:
          title: Litres
          placeholder: L
          min: 0

      - id: save_button
        type: Button
        properties:
          title: Save
          block: true
          icon: AiOutlineSave
        events:
          onClick:
            - id: get_location
              type: GeolocationCurrentPosition
              params:
                enableHighAccuracy: true
            - id: set_location
              type: SetState
              params:
                new.location:
                  _actions: get_location.response.coords
            - id: validate
              type: Validate
            - id: insert_entry
              type: Request
              messages:
                success: Saved! Thank you!⛽️
              params: insert_entry
            - id: reset
              type: Reset
